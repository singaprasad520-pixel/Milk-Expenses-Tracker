<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Milk Expenses Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    background: #181820;
    color: #ffd174;
    font-family: 'Inter', Arial, sans-serif;
    margin: 0;
  }
  .header-bar {
    background: #22222c;
    color: #ffd174;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 18px;
    border-bottom: 1.5px solid #392f13;
  }
  .header-left, .header-right {
    display: flex;
    align-items: center;
    gap: 15px;
  }
  .logo-svg {
    width: 32px;
    height: 32px;
  }
  nav.nav-tabs {
    display: flex;
    gap: 14px;
  }
  nav.nav-tabs button {
    background: none;
    border: none;
    color: #bb9555;
    font-size: 1em;
    font-weight: 700;
    border-bottom: 2.5px solid transparent;
    padding: 7px 14px;
    border-radius: 8px 8px 0 0;
    cursor: pointer;
    transition: background 0.18s;
  }
  nav.nav-tabs button.active {
    color: #ffd174;
    border-bottom-color: #ffd174;
    background: #231f13;
  }
  .main-content {
    max-width: 450px;
    margin: 0 auto;
    padding: 20px 12px 90px 12px;
  }
  .tab-section {
    display: none;
  }
  .tab-section.active {
    display: block;
  }
  .chip-row {
    margin: 0 8px 18px 8px;
    display: flex;
    gap: 10px;
    overflow-x: auto;
  }
  .chip {
    background: #252122;
    color: #ffd174;
    border-radius: 15px;
    padding: 7px 18px;
    font-weight: 800;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 1px 10px #ffd37488;
    font-size: 1.07em;
  }
  .card {
    background: #22222c;
    color: #ffd174;
    border-radius: 21px;
    padding: 22px 20px 17px 20px;
    margin-bottom: 20px;
    box-shadow: 0 0 16px #321e02aa inset, 0 3px 30px #000000bb;
  }
  .card-title {
    font-size: 1.15em;
    font-weight: 800;
    margin-bottom: 9px;
  }
  .card-value {
    font-size: 2.4em;
    font-weight: 900;
    color: #ffe672;
  }
  .card-value.small {
    font-size: 1.3em;
    color: #ffeea9;
  }
  .stats-list {
    margin: 24px 0 12px 0;
    padding: 0;
  }
  .stats-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px 20px;
    margin-bottom: 12px;
    background: #22222c;
    border-radius: 21px;
    color: #ffd174;
    font-weight: 700;
    font-size: 1.12em;
    box-shadow: 0 0 8px #492e0144;
  }
  .stats-item i {
    font-size: 1.3em;
    color: #febf42;
  }
  .chart {
    background: #19191d;
    border-radius: 18px;
    height: 140px;
    position: relative;
    opacity: 0;
    animation: fadeIn 0.6s ease forwards;
    animation-delay: 0.3s;
  }
  @keyframes fadeIn {
    to { opacity: 1; }
  }
  .pie-legend {
    margin-top: 13px;
    margin-bottom: 5px;
    gap: 30px;
    display: flex;
    justify-content: center;
    font-weight: 700;
    color: #fff;
  }
  .pie-legend span {
    gap: 10px;
    display: flex;
    align-items: center;
  }
  .pie-legend .dot {
    width: 18px;
    height: 18px;
    border-radius: 50%;
  }
  .pie-legend .orange {
    background-color: #febf42;
  }
  .pie-legend .dark {
    background-color: #361e02;
  }
  .expense-list {
    margin-top: 20px;
  }
  .expense-item {
    background: #22222c;
    color: #ffd174;
    border-radius: 21px;
    padding: 18px 20px;
    margin-bottom: 16px;
    box-shadow: 0 0 18px #492e01cc;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  .expense-info {
    flex: 1;
    font-size: 1.1em;
    line-height: 1.5;
  }
  .expense-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-left: 15px;
  }
  .expense-actions button {
    background: #ffae2b;
    border: none;
    border-radius: 8px;
    color: #181820;
    font-weight: 700;
    font-size: 1em;
    padding: 10px 26px;
    cursor: pointer;
    box-shadow: 0 1px 8px #ffae2b99;
    transition: background-color 0.18s ease, transform 0.14s ease;
  }
  .expense-actions button:hover {
    background-color: #ffd774;
    transform: scale(1.06);
  }
  form {
    background: #22222c;
    border-radius: 20px;
    padding: 24px 22px;
    box-shadow: 0 0 30px #ffae2b33;
    margin-top: 36px;
  }
  form h2 {
    color: #ffd174;
    font-weight: 900;
    margin-bottom: 18px;
    font-size: 1.4em;
  }
  form label {
    color: #ffd974;
    font-weight: 700;
    font-size: 1.1em;
    display: block;
    margin: 10px 0 7px 0;
  }
  form input, form select {
    width: 100%;
    padding: 14px 16px;
    border-radius: 10px;
    border: 2px solid #ffd774;
    background: #181820;
    color: #ffedbb;
    font-size: 1.1em;
    outline: none;
    box-sizing: border-box;
    transition: border-color 0.22s ease;
  }
  form input:focus, form select:focus {
    border-color: #ffae2b;
  }
  form button {
    background-color: #ffae2b;
    border: none;
    border-radius: 12px;
    padding: 16px 30px;
    font-weight: 900;
    font-size: 1.2em;
    color: #261e0c;
    margin-top: 18px;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.15s ease;
    margin-right: 14px;
  }
  form button:hover {
    background-color: #ffd774;
    transform: scale(1.05);
  }
  form button:active {
    transform: scale(0.95);
  }
  .cancel-btn {
    background-color: #451d00;
    color: #ffd774;
    font-weight: 700;
    cursor: pointer;
  }
  #addExpenseBtn {
    position: fixed;
    right: 24px;
    bottom: 70px;
    background: #febf42;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 2.5em;
    color: #361d03;
    box-shadow: 0 0 22px #febf42cc;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 21;
    transition: background 0.22s ease;
  }
  #addExpenseBtn:hover {
    background: #ffd775;
  }
  #modalForm {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 26px 20px 22px 20px;
    background: #22222c;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 0 32px #f9cd4d99;
    max-width: 400px;
    margin: 0 auto;
    opacity: 0;
    transform: translateY(100%);
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 30;
  }
  #modalForm.active {
    opacity: 1;
    transform: translateY(0);
  }
  #toast {
    position: fixed;
    bottom: 130px;
    left: 50%;
    transform: translateX(-50%);
    background: #febf42;
    color: #361d03;
    padding: 14px 28px;
    font-weight: 700;
    font-size: 1.3em;
    border-radius: 24px;
    box-shadow: 0 0 30px #febf42cc;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.5s ease;
    z-index: 50;
  }
  #toast.visible {
    opacity: 1;
    pointer-events: all;
  }
  @media (max-width: 500px) {
    .main-content {
      padding: 15px 8px 90px 8px;
      max-width: 100vw;
    }
    #modalForm {
      width: 95vw;
      max-width: none;
      border-radius: 15px 15px 0 0;
    }
  }
</style>
</head>
<body>
  <header class="header-bar" role="banner">
    <div class="header-left">
      <span class="logo-svg" aria-label="Milk Tracker Logo" role="img">
        <svg viewBox="0 0 54 54" width="32" height="32" aria-hidden="true"><circle cx="27" cy="27" r="27" fill="#fff4db"/><path d="M13 15 Q10 8 17 11" stroke="#b17c05" stroke-width="2" fill="none"/><path d="M41 15 Q44 8 37 11" stroke="#b17c05" stroke-width="2" fill="none"/><ellipse cx="27" cy="27" rx="12.5" ry="15" fill="#fbdf81" stroke="#bfa038" stroke-width="1.8"/><ellipse cx="15" cy="27" rx="3.2" ry="7.8" fill="#fff4bb" stroke="#bfa038" stroke-width="1.6"/><ellipse cx="39" cy="27" rx="3.2" ry="7.8" fill="#fff4bb" stroke="#bfa038" stroke-width="1.6"/><circle cx="27" cy="23" r="2" fill="#febf42"/><ellipse cx="23" cy="30" rx="1.1" ry="1.6" fill="#3c321d"/><ellipse cx="30" cy="30" rx="1.1" ry="1.6" fill="#3c321d"/><ellipse cx="27" cy="36" rx="4.6" ry="2" fill="#fff9b3" stroke="#bfa038" stroke-width="1.4"/><ellipse cx="25" cy="36.2" rx="0.4" ry="0.8" fill="#382f10"/><ellipse cx="29" cy="36.2" rx="0.4" ry="0.8" fill="#382f10"/></svg>
      </span>
      <nav class="nav-tabs" role="tablist" aria-label="Primary Navigation">
        <button role="tab" aria-selected="true" aria-controls="dashboard" id="dashboard-tab" class="tab-btn active" onclick="showTab('dashboard')">Dashboard</button>
        <button role="tab" aria-selected="false" aria-controls="expenses" id="expenses-tab" class="tab-btn" onclick="showTab('expenses')">Expenses</button>
      </nav>
    </div>
    <div class="header-right" role="region" aria-label="User and notifications">
      <button aria-label="Notifications" style="background:none;border:none;color:#febf42;font-size:1.4em;cursor:pointer;">
        <i class="fas fa-bell"></i>
      </button>
      <span aria-label="User Profile" role="img" tabindex="0" class="avatar-svg" title="User Avatar">
        <svg viewBox="0 0 32 32" width="32" height="32" aria-hidden="true"><ellipse cx="16" cy="17" rx="8" ry="8" fill="#fbeabc"/><ellipse cx="16" cy="14" rx="10" ry="8.6" fill="#b89d5a"/><ellipse cx="11" cy="14" rx="3" ry="3" fill="#c9bd85"/><ellipse cx="21" cy="14" rx="3" ry="3" fill="#c9bd85"/><ellipse cx="19" cy="19" rx="4.3" ry="3" fill="#fbecbc"/></svg>
      </span>
    </div>
  </header>
  <main class="main-content" role="main">
    <section id="dashboard" class="tab-section active" role="tabpanel" aria-labelledby="dashboard-tab">
      <div class="chip-row" id="dashboardChips" aria-live="polite"></div>
      <div class="card">
        <div class="card-title">Total Milk Expense</div>
        <div class="card-value" id="totalExpense">₹0.00</div>
      </div>
      <div class="card">
        <div class="card-title">Average Price Per Liter</div>
        <div class="card-value small" id="avgPrice">₹0.00</div>
      </div>
      <div class="card">
        <div class="card-title">Milk Expense Over Time</div>
        <div class="chart" role="img" aria-label="Bar chart showing milk expenses over time">
          <canvas id="barChart"></canvas>
        </div>
        <div id="barEmpty" class="empty-placeholder" style="color:#ffe6a7b0;">No expenses yet to show</div>
      </div>
      <div class="card">
        <div class="card-title">Expenses By Session</div>
        <div class="chart" role="img" aria-label="Pie chart showing milk expenses by session">
          <canvas id="pieChart"></canvas>
        </div>
        <div id="pieEmpty" class="empty-placeholder" style="color:#ffe6a7b0;">No expenses yet to show</div>
        <div class="pie-legend" aria-hidden="true">
          <span><span class="dot orange"></span>Morning <span id="morningPie">0.00</span></span>
          <span><span class="dot dark"></span>Evening <span id="eveningPie">0.00</span></span>
        </div>
      </div>
      <div class="stats-list" aria-live="polite">
        <div class="stats-item"><i class="fas fa-glass-whiskey"></i><span id="totalEntries">0 Milk Purchases</span></div>
        <div class="stats-item"><i class="fas fa-credit-card"></i>₹<span id="maxExpense">0</span> Max per Purchase</div>
        <div class="stats-item"><i class="fas fa-tint"></i><span><span id="maxLiters">0</span> Largest Quantity (L)</span></div>
      </div>
      <div class="milk-benefits" tabindex="0" aria-label="Milk benefits and nutritional information">
        <h3><i class="fas fa-info-circle"></i> Milk Benefits</h3>
        <ul>
          <li><strong>Rich source of nutrients:</strong> Calcium, vitamin D, protein, vitamins B &amp; A.</li>
          <li><strong>Strong bones and teeth:</strong> Supports growth and reduces osteoporosis risk.</li>
          <li><strong>Complete protein:</strong> Supports muscle maintenance and repair.</li>
          <li><strong>Heart health:</strong> Potassium supports healthy blood pressure.</li>
          <li><strong>Weight management:</strong> Helps control appetite and body weight.</li>
        </ul>
        <div class="ref">Source: Healthline, WebMD, Harvard</div>
      </div>
    </section>
    <section id="expenses" class="tab-section" role="tabpanel" aria-labelledby="expenses-tab">
      <div class="chip-row" id="expensesChips" aria-live="polite"></div>
      <div id="expenseList" class="expense-list" aria-live="polite"></div>
    </section>
  </main>
  <button id="addExpenseBtn" title="Add Expense" aria-label="Add Expense">
    <i class="fas fa-plus"></i>
  </button>
  <div id="modalForm" role="dialog" aria-modal="true" aria-hidden="true">
    <form id="expenseForm" novalidate>
      <h2>Add Expense</h2>
      <label for="inputDate">Date</label>
      <input type="date" id="inputDate" required />
      <label for="inputSession">Session</label>
      <select id="inputSession" name="session" required>
        <option>Morning</option>
        <option>Evening</option>
      </select>
      <label for="inputLiters">Liters</label>
      <input type="number" id="inputLiters" placeholder="Liters" min="0.01" step="0.01" required />
      <label for="inputPrice">Price</label>
      <input type="number" id="inputPrice" placeholder="Price (₹)" min="0.01" step="0.01" required />
      <label for="inputNotes">Notes</label>
      <input type="text" id="inputNotes" placeholder="Optional" />
      <button type="submit" id="submitBtn">Add Expense</button>
      <button type="button" class="cancel-btn" id="cancelBtn">Cancel</button>
    </form>
  </div>
  <div id="toast" aria-live="assertive"></div>
  <script>
    let expenses = [];
    try {
      expenses = JSON.parse(localStorage.getItem('milk_expenses')) || [];
    } catch (e) {
      expenses = [];
    }
    let editIndex = -1;

    function showTab(tab) {
      document.querySelectorAll('.tab-section').forEach((section) => section.classList.remove('active'));
      document.getElementById(tab).classList.add('active');
      document.querySelectorAll('.nav-tabs button').forEach((btn) => btn.classList.remove('active'));
      document.querySelector(`#${tab}-tab`).classList.add('active');
      if (tab === "dashboard") {
        updateDashboard();
        document.getElementById("addExpenseBtn").style.display = "none";
      } else {
        renderExpenses();
        document.getElementById("addExpenseBtn").style.display = "flex";
      }
    }

    document.getElementById("addExpenseBtn").addEventListener("click", () => {
      showTab("expenses");
      openForm();
    });

    function openForm(idx = -1) {
      editIndex = idx;
      const modal = document.getElementById("modalForm");
      const form = document.getElementById("expenseForm");
      if (idx >= 0) {
        const expense = expenses[idx];
        form.inputDate.value = expense.date;
        form.inputSession.value = expense.session;
        form.inputLiters.value = expense.liters;
        form.inputPrice.value = expense.price;
        form.inputNotes.value = expense.notes || "";
        document.getElementById("submitBtn").textContent = "Update Expense";
      } else {
        form.reset();
        // Set today's date as default
        let today = new Date();
        form.inputDate.value = today.toISOString().split("T")[0];
        document.getElementById("submitBtn").textContent = "Add Expense";
      }
      modal.classList.add("active");
      form.inputDate.focus();
    }

    document.getElementById("cancelBtn").addEventListener("click", () => {
      closeForm();
    });

    function closeForm() {
      document.getElementById("modalForm").classList.remove("active");
      editIndex = -1;
    }

    document.getElementById("expenseForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const form = e.target;
      const newExpense = {
        date: form.inputDate.value,
        session: form.inputSession.value,
        liters: parseFloat(form.inputLiters.value),
        price: parseFloat(form.inputPrice.value),
        notes: form.inputNotes.value.trim(),
      };
      if (!newExpense.date || isNaN(newExpense.liters) || newExpense.liters <= 0 || isNaN(newExpense.price) || newExpense.price <= 0) {
        alert("Please enter valid values for date, liters, and price.");
        return;
      }
      if (editIndex >= 0) {
        expenses[editIndex] = newExpense;
        showToast("Expense updated");
      } else {
        expenses.unshift(newExpense);
        showToast("Expense added");
      }
      localStorage.setItem("milk_expenses", JSON.stringify(expenses));
      closeForm();
      renderExpenses();
      updateDashboard();
    });

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.classList.add("visible");
      setTimeout(() => toast.classList.remove("visible"), 1500);
    }

    function renderExpenses() {
      const container = document.getElementById("expenseList");
      updateChips("expensesChips");
      if (expenses.length === 0) {
        container.innerHTML = `<div class="empty-placeholder" style="color:#ffe6a7b0; text-align:center; padding:30px;">No expenses yet.<br>Tap [+] to add one.</div>`;
        return;
      }
      container.innerHTML = expenses
        .map(
          (expense, i) => `
        <div class="expense-item">
          <div class="expense-info">
            <strong>Date:</strong> ${expense.date} &nbsp; <strong>Session:</strong> ${expense.session}<br>
            <strong>Liters:</strong> ${expense.liters} &nbsp; <strong>Price:</strong> ₹${expense.price.toFixed(2)}<br>
            <strong>Notes:</strong> ${expense.notes || "(none)"}
          </div>
          <div class="expense-actions">
            <button aria-label="Edit expense" onclick="openForm(${i})">Edit</button>
            <button aria-label="Delete expense" onclick="deleteExpense(${i})">Delete</button>
          </div>
        </div>
      `
        )
        .join("");
    }

    function updateChips(containerId) {
      const container = document.getElementById(containerId);
      const totalLiters = expenses.reduce((sum, e) => sum + Number(e.liters || 0), 0);
      const totalSpent = expenses.reduce((sum, e) => sum + Number(e.price || 0), 0);
      const avgPrice = totalLiters > 0 ? totalSpent / totalLiters : 0;

      container.innerHTML = `
        <span class="chip"><i class="fas fa-glass-whiskey"></i> ${totalLiters.toFixed(2)} L</span>
        <span class="chip"><i class="fas fa-credit-card"></i> ₹${totalSpent.toFixed(2)} Spent</span>
        <span class="chip"><i class="fas fa-percent"></i> ₹${avgPrice.toFixed(2)} /L</span>
      `;
    }

    function updateDashboard() {
      const totalSpent = expenses.reduce((sum, e) => sum + Number(e.price || 0), 0);
      const totalLiters = expenses.reduce((sum, e) => sum + Number(e.liters || 0), 0);
      const avgPrice = totalLiters > 0 ? totalSpent / totalLiters : 0;

      document.getElementById("totalExpense").textContent = `₹${totalSpent.toFixed(2)}`;
      document.getElementById("avgPrice").textContent = `₹${avgPrice.toFixed(2)}`;
      document.getElementById("totalEntries").textContent = `${expenses.length} Milk Purchases`;

      document.getElementById("maxExpense").textContent = expenses.length
        ? Math.max(...expenses.map((e) => Number(e.price)))
        : 0;
      document.getElementById("maxLiters").textContent = expenses.length
        ? Math.max(...expenses.map((e) => Number(e.liters)))
        : 0;

      const morningTotal = expenses.filter((e) => e.session === "Morning").reduce((sum, e) => sum + Number(e.price), 0);
      const eveningTotal = expenses.filter((e) => e.session === "Evening").reduce((sum, e) => sum + Number(e.price), 0);

      document.getElementById("morningPie").textContent = morningTotal.toFixed(2);
      document.getElementById("eveningPie").textContent = eveningTotal.toFixed(2);

      const days = [...new Set(expenses.map((e) => e.date))];
      const dayTotals = days.map((day) =>
        expenses.filter((e) => e.date === day).reduce((sum, e) => sum + Number(e.price), 0)
      );

      if (window.barChartObj) window.barChartObj.destroy();
      window.barChartObj = new Chart(document.getElementById("barChart").getContext("2d"), {
        type: "bar",
        data: { labels: days, datasets: [{ data: dayTotals, backgroundColor: "#febf42", borderRadius: 6 }] },
        options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } }, responsive: true },
      });

      document.getElementById("barEmpty").style.display = expenses.length ? "none" : "block";

      if (window.pieChartObj) window.pieChartObj.destroy();
      window.pieChartObj = new Chart(document.getElementById("pieChart").getContext("2d"), {
        type: "doughnut",
        data: { labels: ["Morning", "Evening"], datasets: [{ data: [morningTotal, eveningTotal], backgroundColor: ["#febf42", "#361e02"] }] },
        options: { plugins: { legend: { display: false } }, cutout: "67%", responsive: true },
      });

      document.getElementById("pieEmpty").style.display = expenses.length ? "none" : "block";
    }

    function deleteExpense(i) {
      if (confirm("Delete this expense?")) {
        expenses.splice(i, 1);
        localStorage.setItem("milk_expenses", JSON.stringify(expenses));
        renderExpenses();
        updateDashboard();
        showToast("Deleted");
      }
    }

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.classList.add("visible");
      setTimeout(() => toast.classList.remove("visible"), 1400);
    }

    // Initialize
    updateDashboard();
    renderExpenses();
  </script>
</body>
</html>
