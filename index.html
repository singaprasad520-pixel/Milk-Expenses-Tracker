<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta name="description" content="Track your daily milk expenses with modern glassmorphism design">
<meta name="theme-color" content="#6366f1">
<title>Milk Tracker • Modern Dashboard</title>

<link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" as="style">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" />
<script src="https://cdn.jsdelivr.net/npm/chart.js" crossorigin="anonymous"></script>

<style>
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --secondary: #f59e0b;
    --accent: #06d6a0;
    --danger: #ef4444;
    --warning: #f59e0b;
    --success: #10b981;
    --bg-primary: #0f0f23;
    --bg-secondary: #1a1a2e;
    --bg-glass: rgba(255, 255, 255, 0.08);
    --bg-glass-hover: rgba(255, 255, 255, 0.12);
    --text-primary: #ffffff;
    --text-secondary: #a1a1aa;
    --text-accent: #f1f5f9;
    --border-glass: rgba(255, 255, 255, 0.18);
    --shadow-glass: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    --shadow-primary: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    --gradient-success: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    --blur: blur(16px);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    background: var(--bg-primary);
    background-image: 
      radial-gradient(at 40% 20%, hsla(228,100%,74%,1) 0px, transparent 50%),
      radial-gradient(at 80% 0%, hsla(189,100%,56%,1) 0px, transparent 50%),
      radial-gradient(at 0% 50%, hsla(355,100%,93%,1) 0px, transparent 50%),
      radial-gradient(at 80% 50%, hsla(340,100%,76%,1) 0px, transparent 50%),
      radial-gradient(at 0% 100%, hsla(22,100%,77%,1) 0px, transparent 50%),
      radial-gradient(at 80% 100%, hsla(242,100%,70%,1) 0px, transparent 50%),
      radial-gradient(at 0% 0%, hsla(343,100%,76%,1) 0px, transparent 50%);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
  }

  .skip-link {
    position: absolute;
    top: -100px;
    left: 24px;
    background: var(--primary);
    color: white;
    padding: 12px 20px;
    text-decoration: none;
    border-radius: 12px;
    z-index: 1000;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .skip-link:focus {
    top: 24px;
    transform: scale(1.05);
  }

  .header-bar {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 0 0 24px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    margin: 0 16px;
    position: sticky;
    top: 16px;
    z-index: 100;
    box-shadow: var(--shadow-glass);
  }

  .header-left {
    display: flex;
    align-items: center;
    gap: 24px;
  }

  .logo-container {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo-icon {
    width: 40px;
    height: 40px;
    background: var(--gradient-primary);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4);
  }

  .logo-text {
    font-size: 24px;
    font-weight: 800;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .nav-tabs {
    display: flex;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 16px;
    padding: 4px;
    backdrop-filter: blur(8px);
  }

  .nav-tabs button {
    background: none;
    border: none;
    color: var(--text-secondary);
    font-size: 14px;
    font-weight: 600;
    padding: 12px 24px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .nav-tabs button.active {
    background: var(--gradient-primary);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4);
  }

  .nav-tabs button:hover:not(.active) {
    background: rgba(255, 255, 255, 0.08);
    color: var(--text-primary);
  }

  .header-right {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .icon-btn {
    background: rgba(255, 255, 255, 0.08);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-primary);
    transition: all 0.3s ease;
    backdrop-filter: blur(8px);
  }

  .icon-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
  }

  .export-btn {
    background: var(--gradient-success);
    border: none;
    padding: 10px 20px;
    border-radius: 12px;
    color: white;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .export-btn:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
  }

  .main-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 32px 24px 120px;
  }

  .tab-section {
    display: none;
    animation: slideUp 0.5s ease;
  }

  .tab-section.active {
    display: block;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 24px;
    margin-bottom: 32px;
  }

  .glass-card {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 24px;
    padding: 32px;
    box-shadow: var(--shadow-glass);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .glass-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
  }

  .glass-card:hover {
    background: var(--bg-glass-hover);
    transform: translateY(-4px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }

  .card-title {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .card-icon {
    width: 32px;
    height: 32px;
    background: var(--gradient-accent);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
  }

  .card-value {
    font-size: 48px;
    font-weight: 800;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.2;
    margin-bottom: 8px;
  }

  .card-subtitle {
    color: var(--text-secondary);
    font-size: 14px;
    font-weight: 500;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin: 32px 0;
  }

  .stat-card {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 20px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 20px;
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: scale(1.02);
    background: var(--bg-glass-hover);
  }

  .stat-icon {
    width: 56px;
    height: 56px;
    background: var(--gradient-secondary);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
  }

  .stat-content h3 {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .stat-content p {
    color: var(--text-secondary);
    font-size: 14px;
    font-weight: 500;
  }

  .chart-container {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 24px;
    padding: 32px;
    margin: 24px 0;
    position: relative;
    height: 400px;
  }

  .chart-container canvas {
    border-radius: 16px;
  }

  .expense-list {
    display: grid;
    gap: 20px;
    margin-top: 24px;
  }

  .expense-item {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 20px;
    padding: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .expense-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: var(--gradient-primary);
  }

  .expense-item:hover {
    transform: translateX(8px);
    background: var(--bg-glass-hover);
  }

  .expense-details {
    flex: 1;
  }

  .expense-title {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .session-badge {
    background: var(--gradient-accent);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  .expense-meta {
    display: flex;
    gap: 24px;
    color: var(--text-secondary);
    font-size: 14px;
  }

  .expense-actions {
    display: flex;
    gap: 12px;
  }

  .btn {
    background: var(--gradient-primary);
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
  }

  .btn:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
  }

  .btn-danger {
    background: var(--gradient-secondary);
  }

  .btn-danger:hover {
    box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
  }

  .floating-btn {
    position: fixed;
    bottom: 32px;
    right: 32px;
    width: 64px;
    height: 64px;
    background: var(--gradient-primary);
    border: none;
    border-radius: 20px;
    color: white;
    font-size: 24px;
    cursor: pointer;
    box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .floating-btn:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 12px 40px rgba(99, 102, 241, 0.6);
  }

  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(8px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    opacity: 0;
    pointer-events: none;
    transition: all 0.3s ease;
  }

  .modal.active {
    opacity: 1;
    pointer-events: all;
  }

  .modal-content {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 24px;
    padding: 32px;
    width: 90vw;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-glass);
    transform: scale(0.9) translateY(20px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .modal.active .modal-content {
    transform: scale(1) translateY(0);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }

  .modal-title {
    font-size: 24px;
    font-weight: 700;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .close-btn {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    color: var(--text-primary);
  }

  .form-group {
    margin-bottom: 24px;
  }

  .form-label {
    display: block;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 8px;
    font-size: 14px;
  }

  .form-input {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid var(--border-glass);
    border-radius: 12px;
    padding: 16px;
    color: var(--text-primary);
    font-size: 16px;
    transition: all 0.3s ease;
    backdrop-filter: blur(8px);
  }

  .form-input:focus {
    outline: none;
    border-color: var(--primary);
    background: rgba(255, 255, 255, 0.08);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
  }

  .form-input::placeholder {
    color: var(--text-secondary);
  }

  .form-actions {
    display: flex;
    gap: 16px;
    justify-content: flex-end;
    margin-top: 32px;
  }

  .btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text-primary);
  }

  .btn-secondary:hover {
    background: rgba(255, 255, 255, 0.2);
    box-shadow: 0 4px 16px rgba(255, 255, 255, 0.1);
  }

  .toast {
    position: fixed;
    top: 32px;
    right: 32px;
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 16px;
    padding: 16px 24px;
    color: var(--text-primary);
    font-weight: 600;
    box-shadow: var(--shadow-glass);
    transform: translateX(400px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 3000;
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .toast.visible {
    transform: translateX(0);
  }

  .toast-icon {
    width: 20px;
    height: 20px;
    background: var(--gradient-success);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
  }

  .empty-state {
    text-align: center;
    padding: 64px 32px;
    color: var(--text-secondary);
  }

  .empty-icon {
    width: 80px;
    height: 80px;
    background: var(--gradient-secondary);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    margin: 0 auto 24px;
    color: white;
  }

  .empty-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 8px;
  }

  .empty-subtitle {
    font-size: 16px;
    margin-bottom: 32px;
  }

  .chips-container {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    overflow-x: auto;
    padding-bottom: 4px;
  }

  .chip {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 16px;
    padding: 8px 16px;
    font-weight: 600;
    font-size: 14px;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .benefits-card {
    background: var(--bg-glass);
    backdrop-filter: var(--blur);
    border: 1px solid var(--border-glass);
    border-radius: 24px;
    padding: 32px;
    margin-top: 32px;
  }

  .benefits-title {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    color: var(--text-primary);
  }

  .benefits-list {
    list-style: none;
    display: grid;
    gap: 16px;
  }

  .benefit-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 16px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    transition: all 0.3s ease;
  }

  .benefit-item:hover {
    background: rgba(255, 255, 255, 0.06);
  }

  .benefit-icon {
    width: 24px;
    height: 24px;
    background: var(--gradient-success);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    color: white;
    flex-shrink: 0;
  }

  @media (max-width: 768px) {
    .main-content {
      padding: 24px 16px 120px;
    }

    .header-bar {
      margin: 0 8px;
      padding: 16px 20px;
    }

    .dashboard-grid {
      grid-template-columns: 1fr;
    }

    .stats-grid {
      grid-template-columns: 1fr;
    }

    .expense-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 16px;
    }

    .expense-actions {
      width: 100%;
      justify-content: flex-end;
    }

    .modal-content {
      margin: 16px;
      width: calc(100vw - 32px);
    }
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  .loading {
    position: relative;
  }

  .loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 20px;
    height: 20px;
    margin: -10px 0 0 -10px;
    border: 2px solid var(--primary);
    border-radius: 50%;
    border-top-color: transparent;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <header class="header-bar" role="banner">
    <div class="header-left">
      <div class="logo-container">
        <div class="logo-icon">
          <i class="fas fa-glass-whiskey"></i>
        </div>
        <div class="logo-text">MilkTracker</div>
      </div>
      <nav class="nav-tabs" role="tablist" aria-label="Primary Navigation">
        <button role="tab" aria-selected="true" aria-controls="dashboard" id="dashboard-tab" class="active" onclick="MilkTracker.showTab('dashboard')">
          <i class="fas fa-chart-pie"></i> Dashboard
        </button>
        <button role="tab" aria-selected="false" aria-controls="expenses" id="expenses-tab" onclick="MilkTracker.showTab('expenses')">
          <i class="fas fa-list"></i> Expenses
        </button>
      </nav>
    </div>
    <div class="header-right">
      <button class="icon-btn" aria-label="Notifications" title="Notifications">
        <i class="fas fa-bell"></i>
      </button>
      <button class="export-btn" onclick="MilkTracker.exportData()" aria-label="Export data">
        <i class="fas fa-download"></i> Export
      </button>
    </div>
  </header>
  
  <main id="main-content" class="main-content" role="main">
    <section id="dashboard" class="tab-section active" role="tabpanel" aria-labelledby="dashboard-tab">
      <div class="chips-container" id="dashboardChips" aria-live="polite"></div>
      
      <div class="dashboard-grid">
        <div class="glass-card">
          <div class="card-header">
            <div class="card-title">
              <div class="card-icon">
                <i class="fas fa-rupee-sign"></i>
              </div>
              Total Expense
            </div>
          </div>
          <div class="card-value" id="totalExpense">₹0.00</div>
          <div class="card-subtitle">This month's spending</div>
        </div>

        <div class="glass-card">
          <div class="card-header">
            <div class="card-title">
              <div class="card-icon">
                <i class="fas fa-calculator"></i>
              </div>
              Avg Price/Liter
            </div>
          </div>
          <div class="card-value" id="avgPrice">₹0.00</div>
          <div class="card-subtitle">Current market rate</div>
        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-shopping-cart"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalEntries">0</h3>
            <p>Total Purchases</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-arrow-up"></i>
          </div>
          <div class="stat-content">
            <h3>₹<span id="maxExpense">0</span></h3>
            <p>Highest Purchase</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-tint"></i>
          </div>
          <div class="stat-content">
            <h3><span id="maxLiters">0</span>L</h3>
            <p>Largest Quantity</p>
          </div>
        </div>
      </div>

      <div class="chart-container">
        <h3 style="margin-bottom: 24px; color: var(--text-primary);">
          <i class="fas fa-chart-bar" style="margin-right: 12px;"></i>
          Expense Trends
        </h3>
        <canvas id="barChart" style="display: none;"></canvas>
        <div id="barEmpty" class="empty-state" style="display: none;">
          <div class="empty-icon">
            <i class="fas fa-chart-bar"></i>
          </div>
          <div class="empty-title">No data to show</div>
          <div class="empty-subtitle">Add some expenses to see trends</div>
        </div>
      </div>

      <div class="chart-container">
        <h3 style="margin-bottom: 24px; color: var(--text-primary);">
          <i class="fas fa-clock" style="margin-right: 12px;"></i>
          Morning vs Evening
        </h3>
        <canvas id="pieChart" style="display: none;"></canvas>
        <div id="pieEmpty" class="empty-state" style="display: none;">
          <div class="empty-icon">
            <i class="fas fa-chart-pie"></i>
          </div>
          <div class="empty-title">No session data</div>
          <div class="empty-subtitle">Track morning and evening purchases</div>
        </div>
      </div>

      <div class="benefits-card">
        <div class="benefits-title">
          <i class="fas fa-heart" style="color: #ef4444;"></i>
          Health Benefits of Milk
        </div>
        <div class="benefits-list">
          <div class="benefit-item">
            <div class="benefit-icon">
              <i class="fas fa-bone"></i>
            </div>
            <div>
              <strong>Strong Bones:</strong> Rich in calcium and vitamin D for bone health
            </div>
          </div>
          <div class="benefit-item">
            <div class="benefit-icon">
              <i class="fas fa-dumbbell"></i>
            </div>
            <div>
              <strong>Muscle Building:</strong> High-quality protein supports muscle growth
            </div>
          </div>
          <div class="benefit-item">
            <div class="benefit-icon">
              <i class="fas fa-heart"></i>
            </div>
            <div>
              <strong>Heart Health:</strong> Potassium helps maintain healthy blood pressure
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section id="expenses" class="tab-section" role="tabpanel" aria-labelledby="expenses-tab">
      <div class="chips-container" id="expensesChips" aria-live="polite"></div>
      <div id="expenseList" class="expense-list" aria-live="polite"></div>
    </section>
  </main>
  
  <button id="addExpenseBtn" class="floating-btn" title="Add Expense" aria-label="Add new milk expense" style="display: none;">
    <i class="fas fa-plus"></i>
  </button>
  
  <div id="modalForm" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title" class="modal-title">Add Expense</h2>
        <button class="close-btn" id="closeBtn" aria-label="Close">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form id="expenseForm" novalidate>
        <div class="form-group">
          <label class="form-label" for="inputDate">Date *</label>
          <input type="date" id="inputDate" class="form-input" required />
        </div>
        
        <div class="form-group">
          <label class="form-label" for="inputSession">Session *</label>
          <select id="inputSession" class="form-input" required>
            <option value="">Choose session</option>
            <option value="Morning">🌅 Morning</option>
            <option value="Evening">🌆 Evening</option>
          </select>
        </div>
        
        <div class="form-group">
          <label class="form-label" for="inputLiters">Quantity (Liters) *</label>
          <input type="number" id="inputLiters" class="form-input" placeholder="e.g., 1.5" min="0.01" step="0.01" required />
        </div>
        
        <div class="form-group">
          <label class="form-label" for="inputPrice">Price (₹) *</label>
          <input type="number" id="inputPrice" class="form-input" placeholder="e.g., 75.00" min="0.01" step="0.01" required />
        </div>
        
        <div class="form-group">
          <label class="form-label" for="inputNotes">Notes</label>
          <input type="text" id="inputNotes" class="form-input" placeholder="Optional notes..." />
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="cancelBtn">
            <i class="fas fa-times"></i> Cancel
          </button>
          <button type="submit" class="btn" id="submitBtn">
            <i class="fas fa-plus"></i> Add Expense
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <div id="toast" class="toast" aria-live="assertive" role="status">
    <div class="toast-icon">
      <i class="fas fa-check"></i>
    </div>
    <span id="toastMessage">Success!</span>
  </div>
  
  <script>
    // Main Application Object
    const MilkTracker = {
      data: {
        expenses: [],
        editIndex: -1,
        charts: {
          barChart: null,
          pieChart: null
        }
      },
      
      init() {
        this.loadExpenses();
        this.bindEvents();
        this.render();
        this.setDefaultDate();
      },
      
      loadExpenses() {
        try {
          const stored = localStorage.getItem('milk_expenses');
          this.data.expenses = stored ? JSON.parse(stored) : [];
        } catch (error) {
          console.error('Error loading expenses:', error);
          this.data.expenses = [];
          this.showToast('Error loading saved data', 'error');
        }
      },
      
      saveExpenses() {
        try {
          localStorage.setItem('milk_expenses', JSON.stringify(this.data.expenses));
          return true;
        } catch (error) {
          console.error('Error saving expenses:', error);
          this.showToast('Error saving data. Storage may be full.', 'error');
          return false;
        }
      },
      
      bindEvents() {
        // Add expense button
        document.getElementById('addExpenseBtn').addEventListener('click', () => {
          this.openForm();
        });
        
        // Cancel buttons
        document.getElementById('cancelBtn').addEventListener('click', () => {
          this.closeForm();
        });
        
        document.getElementById('closeBtn').addEventListener('click', () => {
          this.closeForm();
        });
        
        // Form submission
        document.getElementById('expenseForm').addEventListener('submit', (e) => {
          this.handleFormSubmit(e);
        });
        
        // Modal keyboard handling
        document.getElementById('modalForm').addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.closeForm();
          }
        });

        // Modal backdrop click
        document.getElementById('modalForm').addEventListener('click', (e) => {
          if (e.target === e.currentTarget) {
            this.closeForm();
          }
        });
      },
      
      setDefaultDate() {
        const today = new Date();
        const dateStr = today.toISOString().split('T')[0];
        document.getElementById('inputDate').value = dateStr;
      },
      
      showTab(tab) {
        // Update tab sections
        document.querySelectorAll('.tab-section').forEach(section => {
          section.classList.remove('active');
        });
        document.getElementById(tab).classList.add('active');
        
        // Update tab buttons
        document.querySelectorAll('.nav-tabs button').forEach(btn => {
          btn.classList.remove('active');
          btn.setAttribute('aria-selected', 'false');
        });
        const activeTab = document.querySelector(`#${tab}-tab`);
        activeTab.classList.add('active');
        activeTab.setAttribute('aria-selected', 'true');
        
        // Show/hide add button and render appropriate content
        if (tab === 'dashboard') {
          this.updateDashboard();
          document.getElementById('addExpenseBtn').style.display = 'none';
        } else {
          this.renderExpenses();
          document.getElementById('addExpenseBtn').style.display = 'flex';
        }
      },
      
      openForm(index = -1) {
        this.data.editIndex = index;
        const modal = document.getElementById('modalForm');
        const form = document.getElementById('expenseForm');
        
        if (index >= 0) {
          // Edit mode
          const expense = this.data.expenses[index];
          form.inputDate.value = expense.date;
          form.inputSession.value = expense.session;
          form.inputLiters.value = expense.liters;
          form.inputPrice.value = expense.price;
          form.inputNotes.value = expense.notes || '';
          document.getElementById('submitBtn').innerHTML = '<i class="fas fa-save"></i> Update Expense';
          document.getElementById('modal-title').textContent = 'Edit Expense';
        } else {
          // Add mode
          form.reset();
          this.setDefaultDate();
          document.getElementById('submitBtn').innerHTML = '<i class="fas fa-plus"></i> Add Expense';
          document.getElementById('modal-title').textContent = 'Add Expense';
        }
        
        modal.classList.add('active');
        modal.setAttribute('aria-hidden', 'false');
        
        // Focus first input
        setTimeout(() => {
          form.inputDate.focus();
        }, 100);
      },
      
      closeForm() {
        const modal = document.getElementById('modalForm');
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden', 'true');
        this.data.editIndex = -1;
      },
      
      handleFormSubmit(e) {
        e.preventDefault();
        const form = e.target;
        
        const newExpense = {
          date: form.inputDate.value,
          session: form.inputSession.value,
          liters: parseFloat(form.inputLiters.value),
          price: parseFloat(form.inputPrice.value),
          notes: form.inputNotes.value.trim()
        };
        
        // Validation
        if (!this.validateExpense(newExpense)) {
          return;
        }
        
        if (this.data.editIndex >= 0) {
          // Update existing expense
          this.data.expenses[this.data.editIndex] = newExpense;
          this.showToast('Expense updated successfully! ✨', 'success');
        } else {
          // Add new expense
          this.data.expenses.unshift(newExpense);
          this.showToast('New expense added! 🎉', 'success');
        }
        
        if (this.saveExpenses()) {
          this.closeForm();
          this.renderExpenses();
          this.updateDashboard();
        }
      },
      
      validateExpense(expense) {
        const errors = [];
        
        if (!expense.date) errors.push('Date is required');
        if (!expense.session) errors.push('Session is required');
        if (isNaN(expense.liters) || expense.liters <= 0) errors.push('Valid quantity required');
        if (isNaN(expense.price) || expense.price <= 0) errors.push('Valid price required');
        
        if (errors.length > 0) {
          this.showToast(errors[0], 'error');
          return false;
        }
        return true;
      },
      
      renderExpenses() {
        const container = document.getElementById('expenseList');
        this.updateChips('expensesChips');
        
        if (this.data.expenses.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-glass-whiskey"></i>
              </div>
              <div class="empty-title">No milk purchases yet</div>
              <div class="empty-subtitle">Start tracking your daily milk expenses</div>
              <button onclick="MilkTracker.openForm()" class="btn" style="margin-top: 20px;">
                <i class="fas fa-plus"></i> Add First Purchase
              </button>
            </div>
          `;
          return;
        }
        
        container.innerHTML = this.data.expenses
          .map((expense, i) => `
            <div class="expense-item">
              <div class="expense-details">
                <div class="expense-title">
                  ${this.formatDate(expense.date)}
                  <span class="session-badge">${expense.session === 'Morning' ? '🌅' : '🌆'} ${expense.session}</span>
                </div>
                <div class="expense-meta">
                  <span><i class="fas fa-tint"></i> ${expense.liters}L</span>
                  <span><i class="fas fa-rupee-sign"></i> ${expense.price.toFixed(2)}</span>
                  <span><i class="fas fa-calculator"></i> ₹${(expense.price / expense.liters).toFixed(2)}/L</span>
                </div>
                ${expense.notes ? `<div style="margin-top: 8px; color: var(--text-secondary); font-size: 14px;"><i class="fas fa-sticky-note"></i> ${expense.notes}</div>` : ''}
              </div>
              <div class="expense-actions">
                <button class="btn" onclick="MilkTracker.openForm(${i})" aria-label="Edit expense">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger" onclick="MilkTracker.deleteExpense(${i})" aria-label="Delete expense">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
          `)
          .join('');
      },
      
      updateChips(containerId) {
        const container = document.getElementById(containerId);
        const totalLiters = this.data.expenses.reduce((sum, e) => sum + Number(e.liters || 0), 0);
        const totalSpent = this.data.expenses.reduce((sum, e) => sum + Number(e.price || 0), 0);
        const avgPrice = totalLiters > 0 ? totalSpent / totalLiters : 0;
        
        container.innerHTML = `
          <span class="chip">
            <i class="fas fa-tint"></i> ${totalLiters.toFixed(2)}L Total
          </span>
          <span class="chip">
            <i class="fas fa-rupee-sign"></i> ₹${totalSpent.toFixed(2)} Spent
          </span>
          <span class="chip">
            <i class="fas fa-calculator"></i> ₹${avgPrice.toFixed(2)}/L Avg
          </span>
          <span class="chip">
            <i class="fas fa-calendar"></i> ${this.data.expenses.length} Purchases
          </span>
        `;
      },
      
      updateDashboard() {
        const totalSpent = this.data.expenses.reduce((sum, e) => sum + Number(e.price || 0), 0);
        const totalLiters = this.data.expenses.reduce((sum, e) => sum + Number(e.liters || 0), 0);
        const avgPrice = totalLiters > 0 ? totalSpent / totalLiters : 0;
        
        // Update main metrics
        document.getElementById('totalExpense').textContent = `₹${totalSpent.toFixed(2)}`;
        document.getElementById('avgPrice').textContent = `₹${avgPrice.toFixed(2)}`;
        document.getElementById('totalEntries').textContent = this.data.expenses.length;
        
        // Update stats
        if (this.data.expenses.length > 0) {
          document.getElementById('maxExpense').textContent = Math.max(...this.data.expenses.map(e => Number(e.price))).toFixed(2);
          document.getElementById('maxLiters').textContent = Math.max(...this.data.expenses.map(e => Number(e.liters))).toFixed(2);
        } else {
          document.getElementById('maxExpense').textContent = '0';
          document.getElementById('maxLiters').textContent = '0';
        }
        
        this.updateChips('dashboardChips');
        this.renderCharts();
      },
      
      renderCharts() {
        this.renderBarChart();
        this.renderPieChart();
      },
      
      renderBarChart() {
        const canvas = document.getElementById('barChart');
        const emptyDiv = document.getElementById('barEmpty');
        
        if (this.data.expenses.length === 0) {
          emptyDiv.style.display = 'block';
          canvas.style.display = 'none';
          return;
        }
        
        emptyDiv.style.display = 'none';
        canvas.style.display = 'block';
        
        // Prepare data - limit to last 7 days for mobile
        const isMobile = window.innerWidth <= 768;
        const days = [...new Set(this.data.expenses.map(e => e.date))].sort().slice(isMobile ? -5 : -7);
        const dayTotals = days.map(day =>
          this.data.expenses
            .filter(e => e.date === day)
            .reduce((sum, e) => sum + Number(e.price), 0)
        );
        
        // Destroy existing chart
        if (this.data.charts.barChart) {
          this.data.charts.barChart.destroy();
        }
        
        // Create new chart
        const ctx = canvas.getContext('2d');
        this.data.charts.barChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: days.map(date => this.formatDateShort(date)),
            datasets: [{
              data: dayTotals,
              backgroundColor: 'rgba(99, 102, 241, 0.8)',
              borderColor: 'rgba(99, 102, 241, 1)',
              borderWidth: 1,
              borderRadius: isMobile ? 4 : 8,
              borderSkipped: false
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: { 
                  color: 'rgba(255, 255, 255, 0.7)',
                  font: { size: isMobile ? 10 : 12 },
                  callback: function(value) {
                    return '₹' + value;
                  }
                },
                grid: {
                  color: 'rgba(255, 255, 255, 0.1)'
                }
              },
              x: {
                ticks: { 
                  color: 'rgba(255, 255, 255, 0.7)',
                  font: { size: isMobile ? 9 : 11 }
                },
                grid: { display: false }
              }
            },
            elements: {
              bar: {
                borderWidth: isMobile ? 1 : 2
              }
            }
          }
        });
      },
      
      renderPieChart() {
        const canvas = document.getElementById('pieChart');
        const emptyDiv = document.getElementById('pieEmpty');
        
        if (this.data.expenses.length === 0) {
          emptyDiv.style.display = 'block';
          canvas.style.display = 'none';
          return;
        }
        
        emptyDiv.style.display = 'none';
        canvas.style.display = 'block';
        
        // Calculate data
        const morningTotal = this.data.expenses
          .filter(e => e.session === 'Morning')
          .reduce((sum, e) => sum + Number(e.price), 0);
        const eveningTotal = this.data.expenses
          .filter(e => e.session === 'Evening')
          .reduce((sum, e) => sum + Number(e.price), 0);
        
        // Destroy existing chart
        if (this.data.charts.pieChart) {
          this.data.charts.pieChart.destroy();
        }
        
        const isMobile = window.innerWidth <= 768;
        
        // Create new chart
        const ctx = canvas.getContext('2d');
        this.data.charts.pieChart = new Chart(ctx, {
          type: 'doughnut',
          data: {
            labels: ['🌅 Morning', '🌆 Evening'],
            datasets: [{
              data: [morningTotal, eveningTotal],
              backgroundColor: [
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)'
              ],
              borderColor: [
                'rgba(16, 185, 129, 1)',
                'rgba(245, 158, 11, 1)'
              ],
              borderWidth: isMobile ? 1 : 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: 'bottom',
                labels: {
                  color: 'rgba(255, 255, 255, 0.8)',
                  padding: isMobile ? 15 : 20,
                  font: {
                    size: isMobile ? 11 : 14,
                    weight: 'bold'
                  },
                  usePointStyle: true,
                  pointStyle: 'circle'
                }
              }
            },
            cutout: isMobile ? '50%' : '60%'
          }
        });
      },
      
      deleteExpense(index) {
        if (confirm('Are you sure you want to delete this expense? 🗑️')) {
          this.data.expenses.splice(index, 1);
          if (this.saveExpenses()) {
            this.renderExpenses();
            this.updateDashboard();
            this.showToast('Expense deleted successfully! 🗑️', 'success');
          }
        }
      },
      
      exportData() {
        if (this.data.expenses.length === 0) {
          this.showToast('No data to export! 📭', 'warning');
          return;
        }
        
        try {
          const dataStr = JSON.stringify(this.data.expenses, null, 2);
          const blob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          
          const a = document.createElement('a');
          a.href = url;
          a.download = `milk-expenses-${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          
          URL.revokeObjectURL(url);
          this.showToast('Data exported successfully! 📊', 'success');
        } catch (error) {
          console.error('Export error:', error);
          this.showToast('Export failed! ❌', 'error');
        }
      },
      
      formatDate(dateStr) {
        try {
          const date = new Date(dateStr + 'T00:00:00');
          return date.toLocaleDateString('en-IN', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
          });
        } catch (error) {
          return dateStr;
        }
      },

      formatDateShort(dateStr) {
        try {
          const date = new Date(dateStr + 'T00:00:00');
          return date.toLocaleDateString('en-IN', {
            month: 'short',
            day: 'numeric'
          });
        } catch (error) {
          return dateStr;
        }
      },
      
      showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const toastIcon = toast.querySelector('.toast-icon i');
        
        // Update message and icon based on type
        toastMessage.textContent = message;
        
        switch(type) {
          case 'success':
            toastIcon.className = 'fas fa-check';
            toast.querySelector('.toast-icon').style.background = 'var(--gradient-success)';
            break;
          case 'error':
            toastIcon.className = 'fas fa-exclamation-triangle';
            toast.querySelector('.toast-icon').style.background = 'var(--gradient-secondary)';
            break;
          case 'warning':
            toastIcon.className = 'fas fa-info-circle';
            toast.querySelector('.toast-icon').style.background = 'var(--gradient-accent)';
            break;
        }
        
        toast.classList.add('visible');
        
        // Auto-hide toast
        setTimeout(() => {
          toast.classList.remove('visible');
        }, 4000);
        
        // Add haptic feedback on mobile devices
        if ('vibrate' in navigator) {
          navigator.vibrate(type === 'success' ? [50] : [100, 50, 100]);
        }
      },
      
      render() {
        this.updateDashboard();
        this.renderExpenses();
      }
    };
    
    // Initialize app when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      MilkTracker.init();
    });
  </script>
</body>
</html>
